# å¤åˆ»ç”»é¾™äº§å“ä¹‹æ–°æ˜¥æ°”æ³¡å…”

:::tip
>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—
:::

> å¤åˆ»æ˜é‡‘ä¸€ç¯‡ç”»é¾™çš„æ–‡ç« ï¼Œåœ¨å…”å¹´æ˜¥èŠ‚æ¥ä¸´ä¹‹é™…çŒ®ä¸Šä¸€å¹…æ–°æ˜¥æ°”æ³¡å…”ï¼Œåˆ›æ„è™½æ—§ä½†æŠ€æœ¯æ°¸å­˜ï¼Œæœ¬èŠ‚æ¡ˆä¾‹ä»£ç å·²ä¸Šä¼ [1024Code - è®©ç¼–ç¨‹é‡å›ä¹è¶£](https://1024code.com/codecubes/txFfSnp)ï¼Œåœ¨çº¿åä½œç¼–å†™ä»£ç æ›´è½»æ¾ã€‚

å‰ªå½±å›¾ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281025908.png)

## 1. åˆå§‹åŒ–å®¹å™¨

é€šè¿‡ `PIXI` ä¸­çš„ `Application` å¯¹è±¡åˆå§‹åŒ–ä¸€ä¸ªå®½`600`ã€é«˜`1000`ã€ç™½è‰²èƒŒæ™¯çš„å®¹å™¨ï¼Œå¹¶é€šè¿‡`appendChild`æ·»åŠ åˆ°å½“å‰ç»„ä»¶çš„æ¨¡æ¿ä¸­ï¼š
```typescript
const initContainer = () => {
  const app = new PIXI.Application({ 
    width: 600, 
    height: 1000, 
    background: 'fff' 
  });
  container.value.appendChild(app.view);
  return app;
} 
```

## 2. å®ç°æ·»åŠ Spriteå‡½æ•°ï¼š

`Sprite`æ˜¯`PIXI`ä¸­ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæœ€åçš„æ°”æ³¡å…”å°±æ˜¯ç”±ä¸€ä¸ªä¸ªçš„`Sprite`æ‹¼å‡ºæ¥çš„ï¼Œæœ€åå†æŠŠæ¯ä¸€ä¸ª`Sprite`æ·»åŠ åˆ°`stage`ä¸­ï¼š

```typescript
const setSprite = (app: any, x: any, y: any, size: any, scale: any) => {
  let sprite = PIXI.Sprite.from('circle.png');
  sprite.width = size;
  sprite.height = size;
  sprite.x = x * scale - size;
  sprite.y = y * scale - size;
  app.stage.addChild(sprite);
}
```

## 3. æ ¸å¿ƒä¸‰æ­¥ç»˜åˆ¶æ°”æ³¡å…”

### 3.1 åŠ è½½å‰ªå½±å›¾ç‰‡ï¼Œè·å–åƒç´ æ•°æ®

å‰ªå½±å›¾ç‰‡æ˜¯ä¸€å¼ ç”±é»‘è‰²ä¸»ä½“å’Œé€æ˜èƒŒæ™¯æˆ–çº¯è‰²èƒŒæ™¯æ„æˆçš„ä¸€å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬è¦åŠ è½½è¿™å¼ å‰ªå½±å›¾ç‰‡å¹¶è·å–åˆ°æ¯ä¸ªåƒç´ çš„æ•°æ®ã€‚

ä¸‹é¢æ˜¯é€šè¿‡`canvas`æ¥åŠ è½½å›¾ç‰‡çš„è¿‡ç¨‹ï¼Œå¹¶é€šè¿‡`getImageData()`å‡½æ•°è·å–åˆ°äº†ä¸€ä¸ªåŒ…å«ä»¥ `RGBA` ä¸ºé¡ºåºçš„ä¸€ç»´æ•°ç»„æ•°æ®ï¼š
```typescript
const transform = (app: any) => {
  const canvas = document.createElement("canvas") as HTMLCanvasElement;
  const ctx = canvas.getContext("2d") as CanvasRenderingContext2D;
  const image = new Image();
  image.src = "rabbit.jpeg";
  image.onload = () => {
    canvas.width = image.width;
    canvas.height = image.height;
    ctx.drawImage(image, 0, 0);

    // Uint8ClampedArray ç±»å‹
    const imageData = ctx.getImageData(0, 0, image.width, image.height).data;
    consoel.log(imageData) // é•¿åº¦ = é«˜åº¦ Ã— å®½åº¦ Ã— 4 bytes
  }
}
```

### 3.2 ææ¸…æ¥šæ¯ä¸ªåƒç´ çš„é¢œè‰²

éœ€è¦é€šè¿‡åŒå±‚å¾ªç¯æ¥é€è¡Œå¯¹å‰ªå½±å›¾ç‰‡ä¸­çš„æ¯ä¸€ä¸ªåƒç´ è¿›è¡Œæ£€æŸ¥ï¼Œåœ¨éå†æ—¶å¯ä»¥æŒ‡å®šä¸€ä¸ªå›ºå®šçš„`step`æ¥æ§åˆ¶éå†ç‚¹çš„å¯†åº¦ï¼Œåœ¨è·å–æ¯ä¸€ä¸ª`position`çš„æ—¶å€™è¦ä¿æŒæ˜¯ä¸€ç»„`RGBA`4ä½çš„é•¿åº¦çš„å€æ•°ï¼Œè¿™æ ·åœ¨æ‹¿åˆ°æ¯ä¸ªç‚¹ä»¥åï¼Œé€šè¿‡ä¸‹æ ‡æ¥åˆ†åˆ«è·å–åˆ°`R\G\B\A`å››ä¸ªå€¼ï¼š

```typescript
const imageData = ctx.getImageData(0, 0, image.width, image.height).data;
const step = 20; // æ§åˆ¶æ¯ä¸ªç‚¹çš„å¯†åº¦

for (let y = 0; y < image.height; y += step) {
  for (let x = 0; x < image.width; x += step) {
    const position = (image.width * y + x) * 4;

    // 4ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ç»„RGBAæ•°æ®
    const r = imageData[position];
    const g = imageData[position + 1];
    const b = imageData[position + 2];
    const a = imageData[position + 3];

    if (r + g + b === 0 && a !== 0) { // çº¯é»‘
      // TODO ç»˜åˆ¶æ°”æ³¡
    }
  }
}
```

### 3.3 ç€æ‰‹ç»˜åˆ¶æ°”æ³¡å…”

åœ¨è·å–åˆ°æ¯ä¸€ç»„çš„`RGBA`æ•°æ®åï¼Œå¦‚æœ`Rã€Gã€B`å‡ä¸º `0` ä¸”é€æ˜åº¦é `0`ï¼Œé‚£ä¹ˆä»£è¡¨è¿™ä¸ªä½ç½®éœ€è¦ç»˜åˆ¶æ°”æ³¡äº†ï¼Œç»˜åˆ¶çš„æ°”æ³¡å¤§å°éšæœºäº§ç”Ÿï¼š

```typescript

const scale = 0.8; // æ§åˆ¶ç»˜åˆ¶çš„æ•´ä½“ç¼©æ”¾æ¯”

if (r + g + b === 0 && a !== 0) { // çº¯é»‘
  const size = (Math.random() * 10 + 20) / 3;
  let sx = x * scale - size;
  let sy = y * scale - size;
  setSprite(app, sx, sy, size, scale);
}
```


æ°”æ³¡å…”ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281025647.png)

## æ€»ç»“

æœ¬å°èŠ‚å°±åˆ°æ­¤ç»“æŸäº†ï¼Œæ–‡ä¸­æåˆ°çš„åŠ è½½å›¾ç‰‡ã€è·å–åƒç´ ç‚¹ã€éå†æ¯ä¸ªåƒç´ è·å–`RGBA`æ•°æ®éƒ½ææ¸…æ¥šäº†å—ï¼Ÿç ´è§£ç™»å½•æ—¶é‡åˆ°çš„æ»‘åŠ¨éªŒè¯ç æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç”¨åˆ°è¿™é‡Œé¢çš„çŸ¥è¯†ç‚¹å‘¢ï¼Ÿå¤§å®¶å¯ä»¥å‘æ•£ä¸€ä¸‹æ€ç»´ã€‚å†æ¬¡ç¥å„ä½åŒå­¦ï¼Œå…”å¹´å¤§å‰ã€æ–°æ˜¥å¿«ä¹~
