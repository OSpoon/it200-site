# å‘Šè¯‰ä½ ä¸€ç§é˜…è¯»READMEæ–‡æ¡£çš„æ–°æ–¹å¼

:::tip
>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—
:::

æœ€è¿‘åœ¨[å¼€å‘æ•™ç¨‹é›†åˆ](https://document.it200.cn/#/)çš„é¦–é¡µè®¾ç½®æˆäº† **Markmap** çš„é£æ ¼ï¼Œæˆ‘å¯ä»¥åœ¨é¦–é¡µæŸ¥çœ‹å¼€å‘æ•™ç¨‹çš„å®Œæ•´å¤§çº²ï¼Œè¿˜å¯ä»¥é€šè¿‡æ¯ä¸ªèŠ‚ç‚¹å¿«é€Ÿè·³è½¬åˆ°å¯¹åº”çš„ç« èŠ‚ï¼Œä¸‹å›¾å°±æ˜¯é¦–é¡µ **Markmap** éƒ¨åˆ†ã€‚

![å¼€å‘æ•™ç¨‹é›†åˆé¦–é¡µ](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202308222235624.png)

åœ¨[å¼€å‘æ•™ç¨‹é›†åˆ](https://document.it200.cn/#/)çš„å½±å“ä¸‹ï¼Œæˆ‘å‘ç°è¿™å¯èƒ½å¯¹äºé˜…è¯»å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£æ¥è¯´æ˜¯ä¸ªä¸é”™çš„ä½“éªŒï¼Œå› ä¸ºä¸€äº›é•¿æœŸç»´æŠ¤çš„å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£çš„å†…å®¹æ˜¯å¾ˆå¤šçš„ï¼Œåœ¨å°å°çš„å±å¹•ä¸­ç¿»æ‰¾èµ·æ¥ä¹Ÿæ˜¯å¾ˆè´¹åŠ²çš„ã€‚æ¯”å¦‚ä½ æƒ³åœ¨ [rollup-awesome](https://github.com/rollup/awesome) æŸ¥æ‰¾ä¸€ä¸ªåˆé€‚çš„ **Plugin** ï¼Œä½†ä½ ä¸æ˜¯å¾ˆæ¸…æ¥š **Rollup** ç°åœ¨æä¾›äº†å“ªäº› **Plugin** ï¼Œé‚£ä½ åº”è¯¥ä¼šé€šè¿‡æœç´¢ [rollup-awesome](https://github.com/rollup/awesome) çš„ **README** æ–‡æ¡£æˆ–è€…å¿«é€Ÿæµè§ˆæ¥å¯»æ‰¾ä½ å¯èƒ½éœ€è¦çš„ **Plugin**ã€‚

åŸºäºé˜…è¯» **README** æ–‡æ¡£çš„å›°éš¾ï¼Œæˆ‘åœ¨ [Vercel](https://vercel.com/) éƒ¨ç½²äº†ä¸€ä¸ª [PMM](https://github.com/ospoon/pmm) çš„å‰ç«¯é¡¹ç›®ï¼Œé€šè¿‡å°†éœ€è¦é˜…è¯»çš„å¼€æºé¡¹ç›®çš„ `username` å’Œ `resp` æä¾›ç»™ **PMM**ï¼Œ**PMM** å°±ä¼šå°† **README** æ–‡æ¡£çš„å†…å®¹æ¸²æŸ“æˆ **Markmap** çš„é£æ ¼ã€‚ä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œåœ¨ [PMM](https://github.com/ospoon/pmm) ä¸­æä¾›äº†ä¸€ä»½ç”¨åœ¨æ²¹çŒ´æ’ä»¶ä¸Šçš„è„šæœ¬ï¼Œå°†ä¸€ä¸ªå¿«æ·èœå•æ·»åŠ åˆ°å¼€æºé¡¹ç›®ä¸»é¡µã€‚ç°åœ¨çš„ [rollup-awesome](https://pmm-rust.vercel.app/?username=rollup&resp=awesome) å°†æ¸²æŸ“æˆäº†ä¸‹å›¾çš„ **Markmap** çš„é£æ ¼ï¼ŒåŒæ—¶ä½ æ¸…æ™°çš„çœ‹åˆ°äº† [rollup-awesome](https://pmm-rust.vercel.app/?username=rollup&resp=awesome) æä¾›äº† **12** ç±» **Plugin** çš„æ”¯æŒã€‚

![rollup-awesome-markmap](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202308222306003.png)

## PMM é¡¹ç›®åˆ†æ

**PMM** å…¨ç§° **Preview Mark Map**ï¼Œç›®çš„å°±æ˜¯è¦å°†ä¸€ä»½è§„èŒƒçš„å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£æ¸²æŸ“æˆ **Markmap** é£æ ¼ã€‚å®Œæˆ **PMM** é¡¹ç›®éœ€è¦åšä¸‹é¢çš„ä¸¤é¡¹å·¥ä½œï¼š

1. è·å–å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£ï¼›
2. è§£æå¹¶æ¸²æŸ“ **README** æ–‡æ¡£ä¸º **Markmap** é£æ ¼ï¼›

### è·å–å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£

ä¸‹é¢æ˜¯ **rollup** æä¾›çš„ **awesome** é¡¹ç›®çš„ **README** æ–‡æ¡£çš„è®¿é—®åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥è·å–å®Œæ•´çš„ **README** æ–‡æ¡£çš„æ–‡æœ¬å†…å®¹ï¼Œè¿™ä¸ªåœ°å€ä¸­åªæœ‰ **rollup** å’Œ **awesome** æ˜¯å˜é‡ï¼Œ**rollup** æŒ‡å®šçš„æ˜¯ **username** ï¼Œ**awesome** æŒ‡çš„æ˜¯ **resp**ã€‚

```
https://raw.githubusercontent.com/rollup/awesome/master/README.md
```

æ‰€ä»¥æˆ‘åªéœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¼€æºé¡¹ç›®çš„ username å’Œ resp å°±å¯ä»¥æ„å»ºä¸€ä¸ª GET è¯·æ±‚æ¥è·å– README æ–‡æ¡£çš„æ–‡æœ¬å†…å®¹ï¼Œåˆ°ç›®å‰æˆ‘ææ¸…æ¥šäº†å¦‚ä½•è·å–åˆ°å¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£ã€‚æ‰€ä»¥åœ¨ [PMM](https://github.com/ospoon/pmm) é¡¹ç›®æä¾›äº†ä¸€ä¸ª `loadGithubMarkdown(username, resp)` å‡½æ•°æ¥åŠ è½½æŒ‡å®šå¼€æºé¡¹ç›®çš„ **README** æ–‡æ¡£ã€‚

```javascript
export const loadGithubMarkdown = (username: string, resp: string): Promise<string> => {
  return new Promise((resolve, reject) => {
    fetch(`https://raw.githubusercontent.com/${username}/${resp}/master/README.md`)
      .then((response) => response.text())
      .then((text) => resolve(text))
      .catch((error) => reject(error))
  })
}
```

### è§£æ **README** æ–‡æ¡£

è§£æ **README** æ–‡æ¡£çš„ç›®çš„æ˜¯è¦è·å– **Markmap** çš„æºæ•°æ®ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°ä¸€ä¸ªå¼€æºçš„æ¨¡å— `markmap-lib` ï¼Œé€šè¿‡ `markmap-lib` æ¨¡å—å¯¼å…¥ä¸€ä¸ª **Transformer** å¯¹è±¡å¹¶è¿›è¡Œå®ä¾‹åŒ–ï¼Œå†è°ƒç”¨ **Transformer** å®ä¾‹æä¾›çš„ `transform(md)` å‡½æ•°å°±å¯ä»¥å®Œæˆ **README** æ–‡æ¡£çš„è§£æã€‚

```javascript
import { Transformer } from 'markmap-lib'
import type { ITransformResult } from 'markmap-lib'

export const transform = (
  svg: string | SVGElement,
  makrdownContent: string,
  jsonOptions?: IMarkmapJSONOptions | undefined
): Markmap => {
  const transformer: Transformer = new Transformer()
  const transformResult: ITransformResult = transformer.transform(makrdownContent)
}
```

### æ¸²æŸ“ä¸º **Markmap** é£æ ¼

æ¸²æŸ“ä¸º **Markmap** é£æ ¼åŒæ ·éœ€è¦ä¸€ä¸ªå¼€æºæ¨¡å— `markmap-view` çš„æ”¯æŒï¼Œéœ€è¦ä» `markmap-view` æ¨¡å—å¯¼å…¥ `Markmap` å¯¹è±¡ï¼Œ`Markmap` å¯¹è±¡æä¾›çš„é™æ€å‡½æ•° `create(el, options, data)` ï¼Œå¯ä»¥ä¸€æ­¥å°†è§£æçš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ã€‚

```javascript
import { Transformer } from 'markmap-lib'
import type { ITransformResult } from 'markmap-lib'
import { Markmap, deriveOptions } from 'markmap-view'
import type { IMarkmapJSONOptions } from 'markmap-common'

export const transform = (
  svg: string | SVGElement,
  makrdownContent: string,
  jsonOptions?: IMarkmapJSONOptions | undefined
): Markmap => {
  const transformer: Transformer = new Transformer()
  const transformResult: ITransformResult = transformer.transform(makrdownContent)
  const markmapOptions = deriveOptions(jsonOptions)
  return Markmap.create(svg, markmapOptions, transformResult.root)
}
```

PSï¼šå°è£…çš„ `transform()` å‡½æ•°æä¾›äº† `Markmap.create()` ç›¸åŒçš„é€‰é¡¹ï¼Œä¾¿äºåœ¨ä½¿ç”¨æ—¶è¿›è¡Œé…ç½®å¾®è°ƒã€‚

### åœ¨ App ç»„ä»¶å®Œæˆå‡½æ•°çš„è°ƒç”¨

åœ¨ **App** ç»„ä»¶ä¸­è¦åšè¿™ä¹ˆå‡ ä»¶äº‹æƒ…ï¼š
1. è§£æ `window.location` å¾—åˆ° `username` å’Œ `resp`ï¼›
2. è°ƒç”¨ `loadGithubMarkdown` è·å–æ–‡æœ¬å†…å®¹ï¼›
3. è°ƒç”¨ `transform` è§£æå¹¶æ¸²æŸ“ **Markmap**ï¼›

```javascript
export const parseQueryParams = (paramContent: string) => {
  const params = paramContent
    .slice(1)
    .split('&')
    .map((v) => {
      const [key, value] = v.split('=')
      return {
        [key]: value
      }
    })
  const result = params.reduce((preValue, currentValue) => {
    const key = Object.keys(currentValue)[0]
    const value = currentValue[key]
    preValue[key] = value
    return preValue
  }, {})
  return result
}
```

```vue
<script setup lang="ts">
import { onMounted } from 'vue'
import { loadGithubMarkdown, transform, setToolbar, parseQueryParams } from './tool/pmm'

onMounted(async () => {
  const { username, resp } = parseQueryParams(window.location.search)
  const markdownContent = await loadGithubMarkdown(username, resp)
  const mm = transform('#markmap', markdownContent, {
    initialExpandLevel: 2
  })
  setToolbar('app', mm)
})
</script>

<template>
  <svg id="markmap"></svg>
</template>
```

### æä¾›ä¾¿æ·ä½“éªŒï¼ˆ1ï¼‰

**Markmap** é»˜è®¤æ”¯æŒæ‹–æ‹½å’Œç¼©æ”¾ï¼Œè¿™å¯¹äºåœ¨ä¸€èˆ¬å°ºå¯¸çš„å±å¹•ä¸Šä½¿ç”¨èµ·æ¥è¿˜æ˜¯ä¼šæœ‰äº›ä¸ä¾¿ï¼Œæ‰€ä»¥æä¾›äº†å›ºå®šåœ¨å³ä¸‹è§’çš„ **Toolbar** ï¼Œ**Toolbar** åŠŸèƒ½çš„å®ç°ä¾èµ– `markmap-toolbar` æ¨¡å—ï¼Œä¸‹é¢æ˜¯è®¾ç½® **Toolbar** çš„å‡½æ•°ã€‚

```javascript
export const setToolbar = (app: string, markmap: Markmap) => {
  const toolbar: Toolbar = Toolbar.create(markmap)
  toolbar.setBrand(false)
  document.querySelector(`#${app}`)?.append(toolbar?.el)
}
```

å½“ç„¶å…ƒç´ çš„ä½ç½®éœ€è¦ä½ è®¾ç½®ä¸€å°æ®µ **CSS**ï¼š

```css
.mm-toolbar {
  position: absolute;
  bottom: 1.5rem;
  right: 1.5rem;
}
```

### æä¾›ä¾¿æ·ä½“éªŒï¼ˆ2ï¼‰

ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ [PMM](https://github.com/ospoon/pmm) é¡¹ç›®å°±å¯ä»¥æ„å»ºéƒ¨ç½²äº†ï¼Œ[Vercel](https://vercel.com/) å¯¹äºéƒ¨ç½²è¿™æ ·çš„é¡¹ç›®æ¥è¯´æˆ–è®¸æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

å½“ç›®å‰ä¸ºæ­¢ï¼Œä½ å°±å¯ä»¥å°†æƒ³è¦æŸ¥çœ‹çš„å¼€æºé¡¹ç›®çš„ `username` å’Œ `resp` æ‹¼æ¥æˆä¸€ä¸ª **PMM** é¡¹ç›®åˆ†æä¸­æ‰€è¿°çš„åœ°å€å°±å¯ä»¥é˜…è¯» **Markmap** é£æ ¼çš„æ–‡æ¡£äº†ã€‚

å¦‚æœä½ ä½¿ç”¨è¿‡æ²¹çŒ´æ’ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡ä½¿ç”¨æˆ‘ç¼–å†™çš„ **JavaScript** è„šæœ¬ä¸ºä½ æ‰€æµè§ˆçš„å¼€æºé¡¹ç›®ä¸»é¡µæ’å…¥ä¸€ä¸ª **PreviewMarkmap** èœå•å°±å¯ä»¥è·³è¿‡æ‰‹åŠ¨æ‹¼æ¥è®¿é—®åœ°å€çš„æ­¥éª¤ã€‚

```javascript
// ==UserScript==
// @name         Preview Mark Map
// @namespace    https://github.com/
// @version      0.1
// @description  æ·»åŠ  PreviewMarkMap èœå•åˆ°Githubé¡¹ç›®çš„README.mdåã€‚
// @author       å°é‘«åŒå­¦
// @match        https://github.com/*/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=github.com
// @run-at       document-end
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    const rootUrl = 'https://pmm-rust.vercel.app';
    const titleBox = document.querySelector('#readme h2.Box-title');
    const [ username, resp ] = window.location.pathname.slice(1).split('/');
    const pmm = document.createElement('a');
    pmm.id = 'previewMarkmap';
    pmm.textContent = "PreviewMarkmap";
    pmm.target = "_blank";
    pmm.style.marginLeft = '10px';
    pmm.href = `${rootUrl}?username=${username}&resp=${resp}`;
    titleBox.appendChild(pmm);
})();
```

## PMM é¡¹ç›®ä½“éªŒ

* è®¿é—®ï¼šhttps://pmm-rust.vercel.app/?username=vuejs&resp=awesome-vue

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202308221743165.png)

* è®¿é—®ï¼šhttps://pmm-rust.vercel.app/?username=vitejs&resp=awesome-vite

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202308221743075.png)

* è®¿é—®ï¼šhttps://pmm-rust.vercel.app/?username=rollup&resp=awesome

![](https://temp-files-20221205.oss-cn-hangzhou.aliyuncs.com/picgo/202308221743802.png)

## PMM é¡¹ç›®æ€»ç»“

å¯¹æˆ‘æ¥è¯´ [PMM](https://github.com/ospoon/pmm) é¡¹ç›®é€šè¿‡æ”¹å˜ä¼ ç»Ÿçš„ **README** æ–‡æ¡£çš„é˜…è¯»æ–¹å¼ä½¿å¾—æˆ‘å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„å¯¹æ•´ä¸ªå¼€æºé¡¹ç›®æœ‰ä¸ªç»“æ„åŒ–çš„äº†è§£ï¼Œå¯¹äº **README** æ–‡æ¡£å†…å®¹çš„æŸ¥æ‰¾ä¹Ÿæä¾›äº†ä¾¿åˆ©ï¼Œ[PMM](https://github.com/ospoon/pmm) é¡¹ç›®ç›®å‰æ¥è¯´è¿˜åªæ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„éªŒè¯ï¼Œå¯¹äºè§„èŒƒçš„ **README** æ–‡æ¡£æ¸²æŸ“ **Markmap** æ•ˆæœè‰¯å¥½ï¼Œä½†ä¾æ—§ä¼šå­˜åœ¨ä¸€äº›æœªçŸ¥çš„é—®é¢˜ï¼Œå¯¹äºæ²¹çŒ´æ’ä»¶åœ¨ä¸ç”Ÿæ•ˆçš„æƒ…å†µä¸‹è¿˜è¯·åˆ·æ–°é¡µé¢ï¼Œæœ‰ç†Ÿæ‚‰æ²¹çŒ´æ’ä»¶ç¼–å†™çš„å°ä¼™ä¼´å¯ä»¥æä¾›ä¸€ä¸ªé è°±çš„è„šæœ¬ã€‚




