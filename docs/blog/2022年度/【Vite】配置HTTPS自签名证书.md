# ã€Viteã€‘é…ç½®HTTPSè‡ªç­¾åè¯ä¹¦

:::tip
>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—
:::

åœ¨å­¦ä¹ å¼€å‘ **WebRTC** ç›¸å…³çš„é¡¹ç›®çš„æ—¶å€™æ˜¯éœ€è¦ä½¿ç”¨åˆ° **HTTPS** å®‰å…¨åè®®æ‰èƒ½æ­£å¸¸å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ **Vite** æ„å»ºçš„é¡¹ç›®ä¸­å¯ç”¨ **HTTPS** åè®®å¹¶ä¸”é…ç½®è¯ä¹¦æ–‡ä»¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ˜¯éœ€è¦ç”³è¯·å•†ç”¨ç‰ˆè¯ä¹¦ï¼ˆä»˜è´¹ï¼‰çš„ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘çš„å·¥ç¨‹ä¸­å¯ä»¥ä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦æ¥æå®šã€‚

## å¦‚ä½•å¯ç”¨ HTTPSï¼š

### ä»…å¯ç”¨ HTTPSï¼š

**Vite** æ„å»ºçš„é¡¹ç›®é»˜è®¤æ˜¯ä½¿ç”¨çš„ **HTTP** åè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ **vite** çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®å¯ç”¨ï¼Œä¸‹å›¾æ˜¯æˆ‘åœ¨ **vite** æ–‡æ¡£ä¸­æ‰¾åˆ°çš„æˆªå›¾ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281419650.png)

æˆ‘ä»¬å¯ä»¥åœ¨å°†è¿™ä¸ªå±æ€§é…ç½®ä¸º **true** æ¥å¼€å¯ **HTTPS** åè®®ï¼Œé…ç½®åå¹¶é‡å¯æœåŠ¡å°±å¯ä»¥çœ‹åˆ°åœ¨ **CLI** ä¸­æç¤ºçš„æœåŠ¡åœ°å€å˜æˆäº† **HTTPS** ï¼Œå½“ä½ åœ¨æµè§ˆå™¨æ‰“å¼€è¿™ä¸ªåœ°å€çš„æ—¶å€™ä½ ä¼šå‘ç°è¢«æµè§ˆå™¨æ‹¦æˆªäº†ï¼Œè¯ä¹¦æ— æ•ˆã€‚

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281420264.png)

### é…ç½®è¯ä¹¦è¯´æ˜ï¼š

ä»…ä»…å¯ç”¨äº† **HTTPS** æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼ˆä¿®æ”¹æµè§ˆå™¨è®¾ç½®ä¸ºä¸ä¿æŠ¤é™¤å¤–ï¼‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®æœ‰æ•ˆçš„è¯ä¹¦æ‰å¯ä»¥ï¼Œ`server.https`é™¤äº†æ”¯æŒ **Boolean** ç±»å‹ä»¥å¤–ï¼Œè¿˜æ”¯æŒä¼ å…¥ä¸€ä¸ª `https.createServer`çš„é€‰é¡¹ï¼Œä¸‹å›¾æ˜¯ **vite** æ–‡æ¡£å¼•å¯¼åˆ° **Nodejs** çš„å‚æ•°è¯´æ˜ï¼Œkey å’Œ cert åˆ†åˆ«å¯¹åº”ç€å®‰å…¨ç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281420070.png)

## ç”Ÿæˆè‡ªç­¾åè¯ä¹¦æ–‡ä»¶ï¼š

ç”Ÿæˆè¯ä¹¦çš„ä¸»è¦å·¥å…·æ˜¯ä½¿ç”¨ä½¿ç”¨ **OpenSSL** æ¥æ“ä½œä¸€å †å‘½ä»¤ç”Ÿæˆï¼Œæˆ‘ä»¬è¿™é‡Œæ¨èä¸€ä¸ªéå¸¸ç®€å•çš„ç”Ÿæˆè¯ä¹¦çš„æ–¹å¼ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­æ’åç¬¬ä¸€çš„è¿™ä¸ªå¼€æºé¡¹ç›®ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281420854.png)

### åœ¨ Mac ä¸­ä½¿ç”¨ mkcertï¼š

1.  é€šè¿‡ **brew** å®‰è£… **mkcert**ï¼š

```
brew install mkcert
```

æ³¨ï¼šåœ¨ **linux** ä¸­å¯ä»¥ä½¿ç”¨ **apt**ã€**yum**ç­‰å®‰è£…ï¼Œåœ¨ **windows** ä¸­å¯ä»¥æ”¯æŒä¸‹è½½ **exe** æ–‡ä»¶å¹¶æ‹–æ‹½åˆ°ç»ˆç«¯åæ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚

2.  ä½¿ç”¨ **-install** å‘½ä»¤å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿä¸­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡**-uninstall** æ¥ç§»é™¤è¿™ä¸ªè¯ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ mkcert åå¢åŠ ä¸åŒçš„ location æ¥ç”Ÿæˆç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281420360.png)

### ç”Ÿæˆè¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼š

1.  åœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»ºå¹¶è¿›å…¥ keys ç›®å½•ï¼š`mkdir keys && cd keys`ï¼›
1.  æ‰§è¡Œç”Ÿæˆå‘½ä»¤ï¼š`mkcert localhost 127.0.0.1`ï¼›
1.  ä¸‹å›¾æç¤ºæˆ‘ä»¬ç”ŸæˆæˆåŠŸäº†ï¼Œè¯ä¹¦æ–‡ä»¶ `localhost+1.pem` å’Œç§˜é’¥æ–‡ä»¶ `localhost+1-key.pem`ï¼›

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281421766.png)

## åœ¨ Vite ä¸­é…ç½®è¯ä¹¦æ–‡ä»¶ï¼š

#### è°ƒæ•´è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶åï¼š

æˆ‘ä»¬å°†ç”Ÿæˆåˆ° keys æ–‡ä»¶å¤¹ä¸­çš„ç§˜é’¥å’Œè¯ä¹¦æ–‡ä»¶ä¿®æ”¹æˆNodeJs æ–‡æ¡£ä¸­`  https.createServer `ç¤ºä¾‹çš„æ–‡ä»¶åç§°ï¼š

1.  localhost+1.pem **=>** agent2-cert.pemï¼›
1.  localhost+1-key.pem => agent2-key.pemï¼›

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281421323.png)

### å®‰è£…è¯ä¹¦ï¼š

åœ¨ç»ˆç«¯æ‰§è¡Œ `mkcert -install`ï¼Œè¾“å…¥å¯†ç éªŒè¯ï¼ŒæˆåŠŸåå¾—åˆ°å¦‚ä¸‹æç¤ºï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281421921.png)

### è°ƒæ•´ Vite é…ç½®æ–‡ä»¶ï¼š

ä½¿ç”¨ fs æ¨¡å—åˆ†åˆ«è¯»å–è¯ä¹¦å’Œç§˜é’¥æ–‡ä»¶ï¼Œå¹¶é…ç½®åˆ° https å±æ€§ï¼š

```
export default defineConfig({
  plugins: [vue()],
  server: {
    https: {
      key: fs.readFileSync('keys/agent2-key.pem'),
      cert: fs.readFileSync('keys/agent2-cert.pem')
    },
  },
});
```

å†æ¬¡å¯åŠ¨æœåŠ¡æµè§ˆå™¨çš„é¡µé¢åˆ·æ–°åå°†ä¸€åˆ‡æ­£å¸¸è®¿é—®äº†ï¼Œå¹¶ä¸”åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹è¯ä¹¦ä¹Ÿæ˜¯æ­£å¸¸çš„äº†ï¼š

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202308281421387.png)

## ç»“è¯­ï¼š

åœ¨æœ¬åœ°å¼€å‘æˆ–è°ƒè¯•çš„æ—¶å€™æˆ–å¤šæˆ–å°‘ä¼šä½¿ç”¨åˆ° **HTTPS** åè®®ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç®€å•æ–¹ä¾¿çš„å¼€æº **mkcert** å®Œæˆäº†è¯ä¹¦çš„ç”Ÿæˆï¼Œé€šè¿‡æŸ¥çœ‹ **vite** æ–‡æ¡£æˆåŠŸå¯ç”¨äº† **https**ï¼Œæ¥ä¸‹æ¥å°±æ„‰å¿«çš„ç¼–ç å§ã€‚