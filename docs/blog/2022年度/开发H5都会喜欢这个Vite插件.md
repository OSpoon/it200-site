# å¼€å‘H5éƒ½ä¼šå–œæ¬¢è¿™ä¸ªViteæ’ä»¶

:::tip
>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—
:::

> åœ¨å¼€å‘å°ç¨‹åºçš„æ—¶å€™ç»å¸¸ä¼šé€šè¿‡æ‰‹æœºæ‰«æå°ç¨‹åºå¼€å‘å·¥å…·ç”Ÿæˆçš„äºŒç»´ç æ¥å¿«é€Ÿåœ¨æ‰‹æœºä¸Šæ‰“å¼€æ­£åœ¨å¼€å‘çš„å°ç¨‹åºè¿›è¡ŒåŠŸèƒ½è°ƒè¯•ï¼Œä½†æ˜¯åœ¨H5å¼€å‘æ—¶å´è¿˜æ˜¯é€šè¿‡èŠå¤©è½¯ä»¶æ¥ç²˜è´´åœ°å€ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œæ‰€ä»¥æˆ‘å°†ç¼–å†™ä¸€ä¸ªViteæ’ä»¶æ¥æ”¯æŒç»ˆç«¯æ˜¾ç¤ºäºŒç»´ç çš„åŠŸèƒ½ã€‚

## 1. Viteæ’ä»¶å¼€å‘è¾…åŠ©

å¼€å‘Viteæ’ä»¶å»ºè®®ä½¿ç”¨å¼€æºé¡¹ç›®[generator-vite-plugin](https://github.com/OSpoon/generator-vite-plugin)ï¼Œå¯ä»¥é€šè¿‡ç®€å•äº†ä¸¤æ­¥æ“ä½œå®ç°ä¸€ä¸ªViteæ’ä»¶å¼€å‘çš„åŸºæœ¬ç¯å¢ƒ,è¿˜è´´å¿ƒçš„é…ç½®äº†è°ƒè¯•è„šæœ¬æ–¹ä¾¿ç¬¬ä¸€æ¬¡å¼€å‘æ’ä»¶æ—¶æ‰‹å¿™è„šä¹±ï¼›

### 1.1 å®‰è£…generator-vite-pluginï¼š

```bash
$ npm i -g yo
$ npm i -g generator-vite-plugin
```

### 1.2 ç”ŸæˆViteæ’ä»¶åŸºæœ¬ç¯å¢ƒï¼š

```bash
$ yo vite-plugin
```

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202211202145430.gif)

## 2. DevQRCodeæ’ä»¶å¼€å‘

é€šè¿‡ç¬¬ä¸€æ­¥å·²ç»ç”Ÿæˆäº†`vite-plugin-dev-qrcode` æ’ä»¶çš„åŸºæœ¬çŠ¶æ€ï¼Œè¿™é‡Œè¦ä»‹ç»å‡ ä¸ªåŸºæœ¬çš„å‰æè¦ç´ ï¼š

1. æ‰‹æœºç«¯éœ€è¦å’Œç”µè„‘ç«¯å¤„äºåŒä¸€å±€åŸŸç½‘ç¯å¢ƒï¼›
2. æ‰‹æœºç«¯å¿…é¡»ä½¿ç”¨å±€åŸŸç½‘åˆ†é…çš„IPè®¿é—®H5é¡µé¢ï¼ŒLocalåœ°å€æ— æ•ˆï¼›
3. Viteé»˜è®¤å¯åŠ¨ä¸æä¾›Networkåœ°å€ï¼Œéœ€è¦å¢åŠ `--host` å‚æ•°ï¼Œæ’ä»¶ä¸­é»˜è®¤å·²é…ç½®ï¼›

### 2.1 è·å–Viteå¯åŠ¨ååˆ†é…çš„URLsï¼š

`vite`å‘½ä»¤æ‰§è¡Œåä¼šåœ¨ç»ˆç«¯å¯åŠ¨ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå¹¶åˆ†é…ç»™æˆ‘ä»¬è®¿é—®è¯¥æœåŠ¡çš„åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œè¦å…³æ³¨çš„å°±æ˜¯`configureServer` è¿™ä¸ªé’©å­å‡½æ•°ï¼Œé€šè¿‡è¯¥å‡½æ•°æä¾›çš„`server` å¯¹è±¡å¯ä»¥è·å–åˆ°è¯¥æœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼›

åœ¨`server`å¯¹è±¡çš„`ViteDevServer` ç±»å‹å®šä¹‰ä¸­çœ‹åˆ°å¦‚ä¸‹å‚æ•°ï¼Œåœ¨`server.listen` ä¹‹åurlså°†ä¼šæ‰“å°åˆ°ç»ˆç«¯ï¼Œè¿™æ­£æ˜¯æˆ‘è¦æ‰¾çš„å±æ€§ï¼›

```tsx
/**
 * The resolved urls Vite prints on the CLI. null in middleware mode or
 * before `server.listen` is called.
 */
resolvedUrls: ResolvedServerUrls | null;
```

### 2.2 æº¯æºViteå¦‚ä½•ç»ˆç«¯è¾“å‡ºä¿¡æ¯ï¼š

ä¸Šä¸€æ­¥çŸ¥é“äº†urlså¦‚ä½•è·å–ï¼Œè¿™ä¸€æ­¥è¦è§£å†³çš„å°±æ˜¯viteåˆ°åº•æ˜¯å¦‚ä½•è¾“å‡ºurlsåˆ°ç»ˆç«¯çš„ï¼Ÿåœ¨Viteæºç çš„`packages/vite/src/node/server/index.ts` æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹è¿™æ®µå‡½æ•°ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªå‡½æ•°å°†`resolvedUrls` å†…å®¹è¿›è¡Œäº†æ‰“å°ï¼Œåœ¨åŠ ä¸Š`ViteDevServer` ç±»å‹å®šä¹‰ä¸­å¯¹è¯¥å‡½æ•°çš„æ³¨é‡Šï¼Œå°±å®Œå…¨é”å®šäº†è¿™ä¸ªå°±æ˜¯æˆ‘çš„ç›®æ ‡å‡½æ•°ï¼›

```tsx
printUrls() {
  if (server.resolvedUrls) {
    printServerUrls(
      server.resolvedUrls,
      serverConfig.host,
      config.logger.info
    )
  } else if (middlewareMode) {
    throw new Error('cannot print server URLs in middleware mode.')
  } else {
    throw new Error(
      'cannot print server URLs before server.listen is called.'
    )
  }
}
```

```tsx
/**
 * Print server urls
 */
printUrls(): void;
```

### 2.3 ç”ŸæˆäºŒç»´ç å¹¶åœ¨é€‚æ—¶æ‰“å°åˆ°ç»ˆç«¯ï¼š

ç”Ÿæˆçš„äºŒç»´ç è¦åŒurlsä¸€åŒè¾“å‡ºï¼Œä¿æŒä¸€è‡´ï¼Œè¿™é‡Œè¦ä½¿ç”¨åˆ°æ‰©å±•çš„æ‰‹æ®µæ¥è®©`server.printUrls` å¾—åˆ°æ”¯æŒï¼Œç±»ä¼¼çš„æ‰‹æ®µåœ¨Vue2çš„æ•°ç»„å“åº”å¼å®ç°ä¸­ä¹Ÿæœ‰ä½“ç°ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦è¿˜æœ‰å°è±¡ï¼›

å…·ä½“çš„äºŒç»´ç ç”Ÿæˆä½¿ç”¨åˆ°äº†`qrcode-terminal` æ¨¡å—ï¼Œä¸°å¯Œçš„æ ·å¼è¾“å‡ºä½¿ç”¨`kolorist`æ¨¡å—ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```tsx
configureServer(server: ViteDevServer) {
  const _print = server.printUrls;
  server.printUrls = () => {
    _print();
    const host = server.resolvedUrls?.network[0];
    if (host) {
      console.log(`${bold("Scan QR code to open quickly. â¤¦")}`);
      qrcode.generate(`${host}`, { small: true });
    } else {
      console.log(
        `  ${green("âœ")}  ${yellow("Failed to get the network address.")}`
      );
    }
  };
}
```

![](https://picgo-2022.oss-cn-beijing.aliyuncs.com/202211202145448.gif)

## æ€»ç»“ï¼š

å®ç°è¿™ä¸ªæ’ä»¶ä»…ä»…ä½¿ç”¨äº†åå‡ è¡Œä»£ç ï¼ŒæœŸé—´ç¿»é˜…äº†Viteæ’ä»¶çš„å¼€å‘æ–‡æ¡£å’Œæºç ï¼Œåˆ†åˆ«æ‰¾åˆ°äº†å¼€å‘æœåŠ¡å™¨çš„ç›¸å…³é’©å­å‡½æ•°æ‹¿åˆ°äº†Viteæ‰“å°çš„urlsä¿¡æ¯ï¼Œå¹¶é€šè¿‡æ‰©å±•`printUrls` å‡½æ•°åœ¨ä¿è¯åŸå§‹é€»è¾‘æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹å¢åŠ äºŒç»´ç è¾“å‡ºçš„åŠŸèƒ½ã€‚æ€ä¹ˆæ ·ï¼Œè¿™ä¸ªæ’ä»¶ä½ ä¼šå†™äº†å—ï¼Ÿå°è¯•ä¸€ä¸‹å§~