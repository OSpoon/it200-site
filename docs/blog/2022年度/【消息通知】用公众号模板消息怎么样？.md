# ã€æ¶ˆæ¯é€šçŸ¥ã€‘ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ€ä¹ˆæ ·ï¼Ÿ 

:::tip
>ğŸ„Hi~ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°é‘«åŒå­¦ï¼Œèµ„æ·± IT ä»ä¸šè€…ï¼ŒInfoQ çš„ç­¾çº¦ä½œè€…ï¼Œæ“…é•¿å‰ç«¯å¼€å‘å¹¶åœ¨è¿™ä¸€é¢†åŸŸæœ‰å¤šå¹´çš„ç»éªŒï¼Œè‡´åŠ›äºåˆ†äº«æˆ‘åœ¨æŠ€æœ¯æ–¹é¢çš„è§è§£å’Œå¿ƒå¾—
:::

æˆ‘æƒ³åœ¨æ˜é‡‘é€›äº†ä¸€æ®µæ—¶é—´çš„æœ‹å‹æœ‰çœ‹åˆ°å…³äºè‡ªåŠ¨ç­¾åˆ°ç­‰ç›¸å…³çš„æ–‡ç« å§ï¼Œè¿™é‡Œå½“ç„¶ä¸æ˜¯è®²è‡ªåŠ¨ç­¾åˆ°äº†ï¼Œä¸»è¦æ˜¯è¯´è¯´åœ¨ç­¾åˆ°å®Œåå¦‚ä½•é€šçŸ¥åˆ°æˆ‘ä»¬ç­¾åˆ°çš„ç»“æœã€‚åœ¨ä¸€äº›æ–‡ç« ä¸­æˆ‘çœ‹åˆ°æœ‰äººä¼šä½¿ç”¨[Serveré…±](https://link.juejin.cn/?target=https%3A%2F%2Fsct.ftqq.com%2F "https://sct.ftqq.com/")ï¼ˆä¸€ä¸ªé›†æˆäº†å¤šç§æ¶ˆæ¯æ¸ é“çš„æ¨é€æœåŠ¡ï¼‰ï¼Œè¿˜æœ‰è‡ªå·±ç›´æ¥å¯¹æ¥ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ç¾¤æœºå™¨äººçš„ï¼Œå¯¹äºä¸ä½¿ç”¨ä¼å¾®æˆ–é’‰é’‰çš„æœ‹å‹å°±éœ€è¦å®‰è£…å¯¹åº”çš„è½¯ä»¶æ‰å¯ä»¥å®ç°ã€‚å½“ç„¶è¿˜æœ‰ä¸€äº›ä¸“é—¨æ¥æ”¶æ¶ˆæ¯é€šçŸ¥çš„[å¼€æºé¡¹ç›®](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Feasychen%2Fpushdeer "https://github.com/easychen/pushdeer")ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº†è§£ä¸€ä¸‹~

ç°åœ¨æˆ‘ä»¬çš„å¾®ä¿¡éƒ½å…³æ³¨äº†ä¸çŸ¥é“å¤šå°‘ä¸ªå…¬ä¼—å·äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸é˜²å°±å¤šå…³æ³¨ä¸€ä¸ªå…¬ä¼—å·ï¼ˆæµ‹è¯•ï¼‰æ¥æ¥æ”¶é€šçŸ¥ï¼ˆæ€»æ¯”å¤šå®‰è£…ä¸€ä¸ªAppå¥½äº›å§ï¼Œé’‰é’‰å’Œä¼å¾®ä¸‹ç­ä½ æ„¿æ„å¬åˆ°å®ƒçš„å£°éŸ³ï¼Ÿï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨[ã€å…¨å¹²ã€‘ä»é›¶æå®šå¾®ä¿¡SDKæˆæƒ](https://juejin.cn/post/7124455454603739166 "https://juejin.cn/post/7124455454603739166")çš„åŸºç¡€ä¸Šç»§ç»­ä½¿ç”¨å…¬ä¼—å·æä¾›çš„æ¨¡æ¿æ¶ˆæ¯æ¥å®ç°ç­¾åˆ°åæ¨é€ç»“æœçš„ç›®æ ‡~

## 2. æ‹‰å–æºä»£ç å¹¶å¯åŠ¨

1.  æ‹‰å–ä¸Šç¯‡æ–‡ç« æä¾›çš„[æºä»£ç ](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FOSpoon%2Fwechat4node "https://github.com/OSpoon/wechat4node")ï¼›
2.  é…ç½®natappéš§é“å¯¹åº”çš„authtokenï¼›
3.  é…ç½®[æµ‹è¯•å…¬ä¼—å·](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fdebug%2Fcgi-bin%2Fsandboxinfo%3Faction%3Dshowinfo%26t%3Dsandbox%2Findex "https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index")ä¿¡æ¯åˆ°`app\service\WeChat.ts`ï¼›
4.  åŒå‡»natappå¯åŠ¨ç©¿é€ï¼Œæ‰§è¡Œ`yarn dev`å¯åŠ¨åç«¯æœåŠ¡ï¼›

## 3. æ–°å¢æ¶ˆæ¯æµ‹è¯•æ¨¡æ¿

> æµ‹è¯•å…¬ä¼—å·çš„æ¨¡æ¿å†…å®¹æ›´ä¸ºè‡ªç”±ï¼Œå¯¹äºå¼€å‘è€…ä½¿ç”¨æ¥è¯´å†åˆé€‚ä¸è¿‡äº†~

1.  æ¨¡æ¿æ ‡é¢˜ï¼šæ²¡æœ‰è¿‡å¤šé™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é”®å…¥å¦‚ï¼šè‡ªåŠ¨åŒ–ç­¾åˆ°é€šçŸ¥ï¼›
2.  æ¨¡æ¿å†…å®¹ï¼šå‰é¢è¯´äº†å†…å®¹ç›¸å¯¹è‡ªç”±ï¼Œä½†å†…å®¹çš„å ä½å˜é‡æœ‰è¦æ±‚ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦å°†å¹³å°çš„æ¥æºformå½“åšå˜é‡æ¥ä¼ é€’åˆ°æ¨¡æ¿å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿™æ ·å†™ 
```JavaScript
{{ form.DATA }}
```
æ³¨æ„ **å˜é‡.DATA** ä¸ºå›ºå®šå†™æ³•ã€‚

3.  ä¸‹é¢æ˜¯æˆ‘ä»¬è¿™æ¬¡æ‰€ä½¿ç”¨çš„æ¨¡æ¿å†…å®¹ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

```JavaScript
å¹³å°ï¼š{{from.DATA}}
æ—¶é—´ï¼š{{date.DATA}}
ç»“æœï¼š{{result.DATA}}

```

## 4. æ¨¡æ¿æ¶ˆæ¯æ¥å£å¯¹æ¥

åœ¨[æµ‹è¯•å…¬ä¼—å·](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fdebug%2Fcgi-bin%2Fsandboxinfo%3Faction%3Dshowinfo%26t%3Dsandbox%2Findex "https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index")é¡µé¢çš„**ä½“éªŒæ¥å£æƒé™è¡¨**ä¸­æ‰¾åˆ°[æ¨¡æ¿æ¶ˆæ¯ï¼ˆä¸šåŠ¡é€šçŸ¥ï¼‰](https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fdebug%2Fcgi-bin%2Freadtmpl%3Ft%3Dtmplmsg%2Ffaq_tmpl "https://mp.weixin.qq.com/debug/cgi-bin/readtmpl?t=tmplmsg/faq_tmpl")ï¼›

### 4.1äº†è§£æ¥å£çš„ä½¿ç”¨

1.  è·å–**template_id**ï¼šè¿™ä¸ªå‚æ•°åœ¨æ–°å»ºæµ‹è¯•æ¨¡æ¿ååœ¨æ¶ˆæ¯æ¨¡æ¿åˆ—è¡¨æœ‰æ˜¾ç¤ºå¯¹åº”æ¨¡æ¿IDï¼›
2.  æ¥å£åœ°å€ï¼š[api.weixin.qq.com/cgi-bin/mesâ€¦](https://link.juejin.cn/?target=https%3A%2F%2Fapi.weixin.qq.com%2Fcgi-bin%2Fmessage%2Ftemplate%2Fsend%3Faccess_token%3DACCESS_TOKEN "https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=ACCESS_TOKEN")ï¼›
3.  è¯·æ±‚æ–¹å¼ï¼š**POST**ï¼›
4.  å‚æ•°æ ¼å¼ï¼šæŒ‡é€šè¿‡dataä¼ é€’çš„å‚æ•°ï¼Œéœ€è¦æ˜¯jsonæ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®headersä¿¡æ¯`{ 'content-type': 'application/json' }`ï¼›
5.  æŸ¥è¯¢å‚æ•°ï¼šaccess_tokenï¼Œåœ¨ä¸Šä¸€ç¯‡çš„ä¸€å¼€å§‹æˆ‘ä»¬å°±è·å–äº†ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šç›´æ¥ä½¿ç”¨å†™å¥½çš„æ–¹æ³•ï¼›
6.  è¯·æ±‚å‚æ•°ï¼šé€šè¿‡è¡¨æ ¼æ¥ä»‹ç»ï¼š

|  |  |  |
| --- | --- | --- |
| å‚æ•° | ç±»å‹/äºŒçº§å‚æ•° | è¯´æ˜ |
| touser | string | å‘é€åˆ°çš„ç”¨æˆ·IDï¼Œåœ¨å¾®ä¿¡ä¸­openidæ˜¯ä½œä¸ºç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨æµ‹è¯•å…¬ä¼—å·å¹³å°æˆ‘ä»¬æ‰«ç å…³æ³¨æµ‹è¯•å·åä¼šè·å¾— |
| template_id | string | æ¨¡æ¿IDï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°äº†è·å–çš„ä½ç½® |
| url | string | è¿™ä¸ªurlå¯ä»¥å¡«å†™æˆ‘ä»¬ç¤¾åŒºçš„ä¸ªäººä¸»é¡µï¼Œå¦‚æˆ‘çš„æ˜é‡‘ï¼š[juejin.cn/user/396669â€¦](https://juejin.cn/user/3966693685871694 "https://juejin.cn/user/3966693685871694") |
| topcolor | string | é¢œè‰²ä¸é‡è¦ï¼Œå“ˆå“ˆ~ |
| data | object | dataç±»å‹ä¸ºå¯¹è±¡ï¼Œæ¥åŒ…è£…æ¨¡æ¿å†…å®¹ä¸­è®¾ç½®çš„å˜é‡ï¼Œæ³¨æ„**äºŒçº§å‚æ•°è¿˜æœ‰ä»ä¸ºå¯¹è±¡** |
| - | from: { value: string, color: string} | é€šçŸ¥æ¥è‡ªå“ªä¸ªå¹³å°ï¼Œå¦‚æˆ‘ä»¬è¿™æ¬¡çš„é€šçŸ¥å¹³å°æ¥è‡ªæ˜é‡‘ |
| - | date: { value: string, color: string} | é€šçŸ¥å‘é€çš„æ—¶é—´ |
| - | result: { value: string, color: string} | é€šçŸ¥å‘é€çš„ç»“æœ |

### 4.2 ç¼–å†™Controllerï¼Œé…ç½®è·¯ç”±

1.  é€šè¿‡bodyæ¥æ”¶å®¢æˆ·ç«¯ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ä¼ é€’çš„å¹³å°æ¥æºå’Œç­¾åˆ°ç»“æœï¼›
2.  é€šè¿‡å°†ä¿¡æ¯ä¼ é€’åˆ°Serviceæä¾›`sendSignTemplate`æ¥å‘èµ·æ¶ˆæ¯é€šçŸ¥ï¼›

```
public async jueJinSignNotice() {
  const { ctx } = this;
  const { from, result } = ctx.request.body;
  ctx.body = await ctx.service.weChat.sendSignTemplate(from, result);
}

```

3ã€‚ é…ç½®è·¯ç”±ä¿¡æ¯ï¼Œæ³¨æ„æ¥å£ç±»å‹ä¸º**POST**ï¼›

```
router.post('/juejin-sign-notice', controller.home.jueJinSignNotice);

```

### 4.3 åœ¨Serviceç¼–å†™sendTemplateå’ŒsendSignTemplateä¸¤ä¸ªå‡½æ•°

**sendSignTemplate**è´Ÿè´£ç»„è£…æ¨¡æ¿å†…å®¹æ‰€éœ€è¦çš„å˜é‡ï¼Œæ•°æ®å†…å®¹é€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨Controlleræ¥æä¾›ï¼ŒNodeJsä¸­çš„æ—¶é—´è¯·é€šè¿‡toLocaleStringè·å¾—æœ¬åœ°æ—¶é—´ï¼Œé»˜è®¤new Date()åœ¨NodeJsç¯å¢ƒæœ‰8å°æ—¶æ—¶å·®ï¼Œåœ¨åšæ—¶é—´æ¯”è¾ƒçš„æ—¶å€™éœ€è¦ç‰¹åˆ«å…³æ³¨ä¸€ä¸‹~

```
public async sendSignTemplate(from: string, result: string) {
    return await this.sendTemplate({
      from: {
        value: from,
        color: '#173177',
      },
      date: {
        value: new Date().toLocaleString(),
        color: '#173177',
      },
      result: {
        value: result,
        color: '#173177',
      },
    });
  }

```

**sendTemplate**è´Ÿè´£å°†ç»„è£…å¥½çš„æ¨¡æ¿å†…å®¹å‘é€åˆ°æŒ‡å®šçš„ç”¨æˆ·ï¼Œæ›´å¤šçš„æ¨¡æ¿æˆ‘ä»¬å¯ä»¥å¤ç”¨è¿™ä¸€ä¸ªå‡½æ•°~

```
  public async sendTemplate(_data: any) {
    const { ctx } = this;
    const request = async () => {
      const { access_token } = await this.getToken();
      const { data } = await ctx.curl(
        `${URL_TEMPLATE}?access_token=${access_token}`,
        {
          dataType: 'json',
          method: 'POST',
          headers: {
            'content-type': 'application/json',
          },
          data: {
            touser: '',
            template_id: '',
            url: 'https://juejin.cn/user/3966693685871694',
            topcolor: '#FF0000',
            data: _data,
          },
        },
      );
      console.log('[ data ] >', data);
      return data;
    };
    return await request();
  }

```

## 5. éªŒè¯æˆ‘ä»¬çš„æ¥å£æ˜¯å¦å¯ç”¨

æˆ‘ç”µè„‘å¿…å¤‡è½¯ä»¶uToolsï¼Œå¯¹äºä¸å¼ºä¾èµ–postmanå·¥ä½œçš„å°ä¼™ä¼´æ¥è¯´ç®€å•ä¸€æ¬¾å°æ’ä»¶å°±èƒ½æå®š

1.  alt+ç©ºæ ¼å‘¼å‡ºuToolså¹¶åœ¨è¾“å…¥æ¡†é”®å…¥httpï¼ˆå›¾ä¸€ï¼‰ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/77e2545be54f4871ae9032569e92f69d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)

2.  æŒ‰å›è½¦åè¿›å…¥httpæ’ä»¶ç•Œé¢ï¼ˆå›¾äºŒï¼‰:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d4d8899e9f849bc9844c742d73d69fc~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)

3.  ä¿®æ”¹è¯·æ±‚æ–¹å¼å¹¶é”®å…¥è¯·æ±‚åœ°å€å’Œå‚æ•°åç‚¹å‡»å°é£æœºå‘èµ·è¯·æ±‚ï¼ˆå›¾ä¸‰ï¼‰:

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ccd307cb01a84ecf864d4176d6781062~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)

4.  åˆ°å¾®ä¿¡å‘Šè¯‰æˆ‘ä»¬OKï¼Œè¯´æ˜è¿™ä¸€æ¬¡çš„æ¶ˆæ¯é€šçŸ¥å‘é€æˆåŠŸäº†ï¼Œçœ‹åˆ°æ‰‹æœºé€šçŸ¥æ çš„æ¶ˆæ¯äº†å—ï¼Ÿ

## 6. æ€»ç»“

é€šè¿‡å€ŸåŠ©ä¸Šæ¬¡ç¼–å†™çš„æˆæƒä»£ç å®Œæˆäº†æµ‹è¯•å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ï¼Œåœ¨åç»­é‡åˆ°è‡ªå·±çš„å®šæ—¶ä»»åŠ¡åšé€šçŸ¥çš„æ—¶å€™å®Œå…¨å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œç›¸æ¯”é‚®ä»¶é€šçŸ¥ï¼Œä¼å¾®é€šçŸ¥ï¼Œé’‰é’‰é€šçŸ¥ç­‰æ–¹å¼æ¥è¯´æˆ‘ä»¬è¦ä¸æ˜¯èŠ‚çœäº†Appçš„å®‰è£…è¦ä¸å°±æ˜¯é¿å…äº†å…¬ç§æ··æ­ä½¿ç”¨ï¼Œå› ä¸ºç°åœ¨ä»£ç ä»»åœ¨æœ¬åœ°ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰å¿…è¦å†æ¬¡æŠ½æ—¶é—´ä¸Šä¸€æŠŠ**å‡½æ•°è®¡ç®—FCï¼ˆé˜¿é‡Œäº‘ï¼‰** ï¼Œæ”¹å¤©è§~

> æœ¬æ–‡é¡¹ç›®å·²æ¨é€è‡³GitHubï¼Œæ¬¢è¿å…‹éš†æ¼”ç¤ºï¼š`git clone https://github.com/OSpoon/wechat4node.git`